(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[517],{236:function(t,e,s){Promise.resolve().then(s.bind(s,3368))},3368:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return IssuesPage}});var i=s(7437),a=s(2265),n=s(1396),r=s.n(n),o=s(4033),l=s(8038),c=s(9891),u=s(3588),d=s(9843),h=s(5817);let p={low:"bg-slate-100 text-slate-700",medium:"bg-slate-100 text-slate-700",high:"bg-amber-100 text-amber-800",critical:"bg-amber-100 text-amber-800"},m={open:"in_progress",in_progress:"closed",closed:null,archived:null};function label(t){return"open"===t?"Start":"in_progress"===t?"Mark Done":"No Action"}function IssueCard(t){var e,s,a;let{issue:n,onAdvanceStatus:r,isUpdating:o}=t,l=null!==(a=null!==(s=n.id)&&void 0!==s?s:n._id)&&void 0!==a?a:"",c=m[n.status],u=(null===(e=n.assignees)||void 0===e?void 0:e[0])?n.assignees[0]:"Unassigned";return(0,i.jsxs)("div",{className:"rounded-md border border-slate-200 bg-white p-5 shadow-sm",children:[(0,i.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("h3",{className:"text-base font-semibold text-slate-900",children:n.title}),(0,i.jsx)("p",{className:"text-sm text-slate-500",children:n.description||"No description provided."})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(h.Z,{status:n.status}),(0,i.jsx)("span",{className:"inline-flex rounded-md px-2 py-1 text-xs font-medium ".concat(p[n.priority]),children:n.priority})]})]}),(0,i.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,i.jsxs)("p",{className:"text-sm text-slate-600",children:["Assignee: ",u]}),(0,i.jsx)("button",{type:"button",className:"rounded-md border border-slate-300 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 disabled:opacity-60",disabled:!c||o||!l,onClick:()=>{c&&l&&r(l,c)},children:label(n.status)})]})]})}var x=s(7947),g=s(4655);let v=[{value:"",label:"All"},{value:"open",label:"Open"},{value:"in_progress",label:"In Progress"},{value:"closed",label:"Done"},{value:"archived",label:"Archived"}],f=[{value:"",label:"All"},{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"critical",label:"Critical"}],y={low:"text-slate-600",medium:"text-slate-700",high:"text-amber-700",critical:"text-red-600"},b={open:"in_progress",in_progress:"closed",closed:null,archived:null};function shortId(t){return!t||t.length<=10?t:"".concat(t.slice(0,6),"...").concat(t.slice(-4))}function IssuesPage(){var t,e,s,n;let p=(0,o.useParams)(),m=(0,l.NL)(),j=String(p.projectId),[N,S]=(0,a.useState)(""),[C,P]=(0,a.useState)(""),[w,M]=(0,a.useState)(""),[O,I]=(0,a.useState)(1),[F,E]=(0,a.useState)(!1),[R,k]=(0,a.useState)(""),[L,_]=(0,a.useState)(""),[A,T]=(0,a.useState)("medium"),[D,K]=(0,a.useState)({}),[Z,U]=(0,a.useState)(null),[q,G]=(0,a.useState)(null),J=(0,c.a)({queryKey:["project",j],queryFn:()=>(0,d.e5)(j)}),H=(0,a.useMemo)(()=>({status:N,priority:C,page:O,limit:10}),[N,C,O]),Q=(0,c.a)({queryKey:["issues",j,H],queryFn:()=>(0,d.EG)(j,H)}),V=(0,u.D)({mutationFn:d.v,onSuccess:async()=>{E(!1),k(""),_(""),T("medium"),U(null),I(1),await m.invalidateQueries({queryKey:["issues",j]})},onError:t=>U(t.message)}),Y=(0,u.D)({mutationFn:t=>{let{issueId:e,assigneeId:s}=t;return(0,d.gr)(e,s)},onSuccess:async()=>{G(null),await m.invalidateQueries({queryKey:["issues",j]})},onError:t=>G(t.message)}),B=(0,u.D)({mutationFn:t=>{let{issueId:e,nextStatus:s}=t;return(0,d.YW)(e,s)},onSuccess:async()=>{await m.invalidateQueries({queryKey:["issues",j]})}}),W=(0,a.useMemo)(()=>{var t;let e=(null===(t=Q.data)||void 0===t?void 0:t.items)||[],s=w.trim().toLowerCase();return s?e.filter(t=>t.title.toLowerCase().includes(s)):e},[null===(t=Q.data)||void 0===t?void 0:t.items,w]),z=Q.data?Math.max(1,Math.ceil(Q.data.total/Q.data.limit)):1,$=O>1,X=O<z;return(0,i.jsxs)("div",{className:"dt-page",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("p",{className:"text-sm text-slate-500",children:["Projects / ",null!==(n=null===(s=J.data)||void 0===s?void 0:null===(e=s.project)||void 0===e?void 0:e.name)&&void 0!==n?n:"..."]}),(0,i.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,i.jsx)("h1",{className:"dt-title",children:"Issues"}),(0,i.jsx)("button",{type:"button",onClick:()=>E(t=>!t),className:"dt-btn-primary",children:F?"Cancel":"Create Issue"})]}),(0,i.jsx)("p",{className:"text-sm text-slate-600",children:"Manage and track engineering tasks for this project."})]}),F&&(0,i.jsxs)("form",{onSubmit:t=>{t.preventDefault(),U(null),V.mutate({projectId:j,title:R,description:L||void 0,priority:A})},className:"dt-card space-y-4 p-5",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"Title"}),(0,i.jsx)("input",{value:R,onChange:t=>k(t.target.value),className:"dt-input",required:!0})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"Description"}),(0,i.jsx)("textarea",{value:L,onChange:t=>_(t.target.value),className:"dt-input",rows:3})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"Priority"}),(0,i.jsxs)("select",{value:A,onChange:t=>T(t.target.value),className:"dt-select w-full",children:[(0,i.jsx)("option",{value:"low",children:"Low"}),(0,i.jsx)("option",{value:"medium",children:"Medium"}),(0,i.jsx)("option",{value:"high",children:"High"}),(0,i.jsx)("option",{value:"critical",children:"Critical"})]})]}),Z&&(0,i.jsx)(g.Z,{message:Z}),(0,i.jsx)("button",{type:"submit",className:"dt-btn-primary",disabled:V.isPending,children:V.isPending?"Creating...":"Create"})]}),(0,i.jsxs)("div",{className:"dt-panel grid gap-3 lg:grid-cols-4",children:[(0,i.jsx)("select",{value:N,onChange:t=>{S(t.target.value),I(1)},className:"dt-select",children:v.map(t=>(0,i.jsxs)("option",{value:t.value,children:["Status: ",t.label]},t.value))}),(0,i.jsx)("select",{value:C,onChange:t=>{P(t.target.value),I(1)},className:"dt-select",children:f.map(t=>(0,i.jsxs)("option",{value:t.value,children:["Priority: ",t.label]},t.value))}),(0,i.jsx)("input",{value:w,onChange:t=>M(t.target.value),placeholder:"Filter issues...",className:"dt-input lg:col-span-2"})]}),J.isLoading&&(0,i.jsx)(x.Z,{label:"Loading project..."}),J.isError&&(0,i.jsx)(g.Z,{message:J.error.message}),Q.isLoading&&(0,i.jsx)(x.Z,{label:"Loading issues..."}),Q.isError&&(0,i.jsx)(g.Z,{message:Q.error.message}),q&&(0,i.jsx)(g.Z,{message:q}),Q.isSuccess&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"dt-card hidden overflow-hidden lg:block",children:(0,i.jsxs)("table",{className:"dt-table",children:[(0,i.jsx)("thead",{className:"dt-thead",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-4 py-3",children:"Key"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"Title"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"Status"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"Priority"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"Assignee"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"Assign"}),(0,i.jsx)("th",{className:"px-4 py-3 text-right",children:"Action"})]})}),(0,i.jsxs)("tbody",{children:[q&&(0,i.jsx)("tr",{className:"border-b border-slate-100",children:(0,i.jsx)("td",{colSpan:7,className:"px-4 py-3",children:(0,i.jsx)("p",{className:"text-xs text-red-600",children:q})})}),0===W.length?(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:7,className:"px-4 py-6 text-center text-slate-500",children:"No issues found."})}):W.map(t=>{var e,s,a,n;let o=null!==(a=null!==(s=t.id)&&void 0!==s?s:t._id)&&void 0!==a?a:"",l=b[t.status];return(0,i.jsxs)("tr",{className:"dt-row",children:[(0,i.jsxs)("td",{className:"px-4 py-4 text-slate-500",children:["ISS-",o.slice(-4).toUpperCase()]}),(0,i.jsxs)("td",{className:"px-4 py-4",children:[(0,i.jsx)(r(),{href:"/projects/".concat(j,"/issues/").concat(o),className:"font-medium text-slate-900 hover:text-blue-700",children:t.title}),(0,i.jsx)("p",{className:"text-xs text-slate-500",children:t.description||"No description provided."})]}),(0,i.jsx)("td",{className:"px-4 py-4",children:(0,i.jsx)(h.Z,{status:t.status})}),(0,i.jsx)("td",{className:"px-4 py-4 text-xs font-semibold uppercase ".concat(y[t.priority]),children:t.priority}),(0,i.jsx)("td",{className:"px-4 py-4 text-slate-600",children:t.assignees[0]||"Unassigned"}),(0,i.jsx)("td",{className:"px-4 py-4",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("select",{value:null!==(n=D[o])&&void 0!==n?n:"",onChange:t=>K(e=>({...e,[o]:t.target.value})),className:"dt-select px-2 py-1.5 text-xs",children:[(0,i.jsx)("option",{value:"",children:"Select member"}),((null===(e=J.data)||void 0===e?void 0:e.project.members)||[]).map(t=>(0,i.jsx)("option",{value:t,children:shortId(t)},t))]}),(0,i.jsx)("button",{type:"button",disabled:!D[o]||Y.isPending,onClick:()=>{let t=D[o];t&&o&&Y.mutate({issueId:o,assigneeId:t})},className:"dt-btn-ghost px-2 py-1.5",children:"Assign"})]})}),(0,i.jsx)("td",{className:"px-4 py-4 text-right",children:(0,i.jsx)("button",{type:"button",onClick:()=>{l&&o&&B.mutate({issueId:o,nextStatus:l})},disabled:!l||B.isPending,className:"dt-btn-ghost",children:l?"Advance":"Completed"})})]},o)})]})]})}),(0,i.jsxs)("div",{className:"grid gap-4 lg:hidden",children:[q&&(0,i.jsx)(g.Z,{message:q}),0===W.length?(0,i.jsx)(x.Z,{label:"No issues found."}):W.map(t=>{var e;return(0,i.jsx)(IssueCard,{issue:t,isUpdating:B.isPending,onAdvanceStatus:(t,e)=>{B.mutate({issueId:t,nextStatus:e})}},null!==(e=t.id)&&void 0!==e?e:t._id)})]})]}),Q.isSuccess&&(0,i.jsx)(Pagination,{page:O,totalPages:z,canPrev:$,canNext:X,onPrev:()=>I(t=>Math.max(1,t-1)),onNext:()=>I(t=>Math.min(z,t+1))})]})}function Pagination(t){let{page:e,totalPages:s,canPrev:a,canNext:n,onPrev:r,onNext:o}=t;return(0,i.jsxs)("div",{className:"dt-panel flex items-center justify-between",children:[(0,i.jsxs)("p",{className:"text-sm text-slate-600",children:["Page ",e," of ",s]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("button",{type:"button",onClick:r,disabled:!a,className:"dt-btn-secondary px-3 py-2",children:"Previous"}),(0,i.jsx)("button",{type:"button",onClick:o,disabled:!n,className:"dt-btn-primary px-3 py-2",children:"Next"})]})]})}},4655:function(t,e,s){"use strict";s.d(e,{Z:function(){return ErrorState}});var i=s(7437);function ErrorState(t){let{message:e}=t;return(0,i.jsx)("div",{className:"dt-card border-red-200 bg-red-50/40 p-4 text-sm text-red-700",children:e})}},7947:function(t,e,s){"use strict";s.d(e,{Z:function(){return LoadingState}});var i=s(7437);function LoadingState(t){let{label:e="Loading..."}=t;return(0,i.jsx)("div",{className:"dt-card p-5 text-sm text-slate-600",children:e})}},5817:function(t,e,s){"use strict";s.d(e,{Z:function(){return StatusBadge}});var i=s(7437);let a={open:"bg-slate-100 text-slate-700",in_progress:"bg-blue-100 text-blue-700",closed:"bg-green-100 text-green-800",archived:"bg-slate-200 text-slate-700"},n={open:"Open",in_progress:"In Progress",closed:"Done",archived:"Archived"};function StatusBadge(t){let{status:e}=t;return(0,i.jsx)("span",{className:"inline-flex rounded-md px-2 py-1 text-xs font-medium ".concat(a[e]),children:n[e]})}},9843:function(t,e,s){"use strict";s.d(e,{$L:function(){return createProject},$Q:function(){return addProjectMember},EG:function(){return getIssues},Ge:function(){return getIssue},YW:function(){return updateIssueStatus},e5:function(){return getProject},gr:function(){return assignIssue},jo:function(){return getMe},kS:function(){return logout},mW:function(){return getProjects},v:function(){return createIssue},x4:function(){return login},z2:function(){return register}});var i,a=s(2601);let n=null!==(i=a.env.NEXT_PUBLIC_API_URL)&&void 0!==i?i:"http://localhost:4000/api";function toErrorMessage(t,e){if(!t)return e||"Request failed";try{var s,i;let e=JSON.parse(t);if(e.message)return e.message;if(e.error)return e.error;if((null===(s=e.errors)||void 0===s?void 0:s.length)&&(null===(i=e.errors[0])||void 0===i?void 0:i.msg))return e.errors[0].msg}catch(t){}return t}async function apiFetch(t,e){let s=await fetch("".concat(n).concat(t),{credentials:"include",headers:{"Content-Type":"application/json",...(null==e?void 0:e.headers)||{}},...e});if(!s.ok){let t=await s.text();throw Error(toErrorMessage(t,s.statusText))}if(204!==s.status)return await s.json()}function getMe(){return apiFetch("/auth/me")}function login(t){return apiFetch("/auth/login",{method:"POST",body:JSON.stringify(t)})}function register(t){return apiFetch("/auth/register",{method:"POST",body:JSON.stringify(t)})}function logout(){return apiFetch("/auth/logout",{method:"POST"})}function getProjects(){return apiFetch("/projects")}function createProject(t){return apiFetch("/projects",{method:"POST",body:JSON.stringify(t)})}function getProject(t){return apiFetch("/projects/".concat(t))}function addProjectMember(t,e){return apiFetch("/projects/".concat(t,"/members"),{method:"POST",body:JSON.stringify({memberId:e})})}function getIssues(t,e){let s=new URLSearchParams;return e.status&&s.set("status",e.status),e.priority&&s.set("priority",e.priority),e.page&&s.set("page",String(e.page)),e.limit&&s.set("limit",String(e.limit)),apiFetch("/projects/".concat(t,"/issues?").concat(s.toString()))}function createIssue(t){return apiFetch("/projects/".concat(t.projectId,"/issues"),{method:"POST",body:JSON.stringify({title:t.title,description:t.description,priority:t.priority})})}function updateIssueStatus(t,e){return apiFetch("/issues/".concat(t,"/status"),{method:"PATCH",body:JSON.stringify({status:e})})}function assignIssue(t,e){return apiFetch("/issues/".concat(t,"/assign"),{method:"PATCH",body:JSON.stringify({assigneeId:e})})}function getIssue(t){return apiFetch("/issues/".concat(t))}},4033:function(t,e,s){t.exports=s(94)},7470:function(t,e,s){"use strict";s.d(e,{R:function(){return getDefaultState},m:function(){return r}});var i=s(7987),a=s(9024),n=s(1640),r=class extends a.F{#t;#e;#s;#i;constructor(t){super(),this.#t=t.client,this.mutationId=t.mutationId,this.#s=t.mutationCache,this.#e=[],this.state=t.state||getDefaultState(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#e.includes(t)||(this.#e.push(t),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#e=this.#e.filter(e=>e!==t),this.scheduleGc(),this.#s.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#e.length||("pending"===this.state.status?this.scheduleGc():this.#s.remove(this))}continue(){return this.#i?.continue()??this.execute(this.state.variables)}async execute(t){let onContinue=()=>{this.#a({type:"continue"})},e={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#i=(0,n.Mz)({fn:()=>this.options.mutationFn?this.options.mutationFn(t,e):Promise.reject(Error("No mutationFn found")),onFail:(t,e)=>{this.#a({type:"failed",failureCount:t,error:e})},onPause:()=>{this.#a({type:"pause"})},onContinue,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#s.canRun(this)});let s="pending"===this.state.status,i=!this.#i.canStart();try{if(s)onContinue();else{this.#a({type:"pending",variables:t,isPaused:i}),this.#s.config.onMutate&&await this.#s.config.onMutate(t,this,e);let s=await this.options.onMutate?.(t,e);s!==this.state.context&&this.#a({type:"pending",context:s,variables:t,isPaused:i})}let a=await this.#i.start();return await this.#s.config.onSuccess?.(a,t,this.state.context,this,e),await this.options.onSuccess?.(a,t,this.state.context,e),await this.#s.config.onSettled?.(a,null,this.state.variables,this.state.context,this,e),await this.options.onSettled?.(a,null,t,this.state.context,e),this.#a({type:"success",data:a}),a}catch(s){try{await this.#s.config.onError?.(s,t,this.state.context,this,e)}catch(t){Promise.reject(t)}try{await this.options.onError?.(s,t,this.state.context,e)}catch(t){Promise.reject(t)}try{await this.#s.config.onSettled?.(void 0,s,this.state.variables,this.state.context,this,e)}catch(t){Promise.reject(t)}try{await this.options.onSettled?.(void 0,s,t,this.state.context,e)}catch(t){Promise.reject(t)}throw this.#a({type:"error",error:s}),s}finally{this.#s.runNext(this)}}#a(t){this.state=(e=>{switch(t.type){case"failed":return{...e,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...e,isPaused:!0};case"continue":return{...e,isPaused:!1};case"pending":return{...e,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...e,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...e,data:void 0,error:t.error,failureCount:e.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}})(this.state),i.Vr.batch(()=>{this.#e.forEach(e=>{e.onMutationUpdate(t)}),this.#s.notify({mutation:this,type:"updated",action:t})})}};function getDefaultState(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}},3588:function(t,e,s){"use strict";s.d(e,{D:function(){return useMutation}});var i=s(2265),a=s(7470),n=s(7987),r=s(2996),o=s(300),l=class extends r.l{#t;#n=void 0;#r;#o;constructor(t,e){super(),this.#t=t,this.setOptions(e),this.bindMethods(),this.#l()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){let e=this.options;this.options=this.#t.defaultMutationOptions(t),(0,o.VS)(this.options,e)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),e?.mutationKey&&this.options.mutationKey&&(0,o.Ym)(e.mutationKey)!==(0,o.Ym)(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(t){this.#l(),this.#c(t)}getCurrentResult(){return this.#n}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#l(),this.#c()}mutate(t,e){return this.#o=e,this.#r?.removeObserver(this),this.#r=this.#t.getMutationCache().build(this.#t,this.options),this.#r.addObserver(this),this.#r.execute(t)}#l(){let t=this.#r?.state??(0,a.R)();this.#n={...t,isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}}#c(t){n.Vr.batch(()=>{if(this.#o&&this.hasListeners()){let e=this.#n.variables,s=this.#n.context,i={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};if(t?.type==="success"){try{this.#o.onSuccess?.(t.data,e,s,i)}catch(t){Promise.reject(t)}try{this.#o.onSettled?.(t.data,null,e,s,i)}catch(t){Promise.reject(t)}}else if(t?.type==="error"){try{this.#o.onError?.(t.error,e,s,i)}catch(t){Promise.reject(t)}try{this.#o.onSettled?.(void 0,t.error,e,s,i)}catch(t){Promise.reject(t)}}}this.listeners.forEach(t=>{t(this.#n)})})}},c=s(8038);function useMutation(t,e){let s=(0,c.NL)(e),[a]=i.useState(()=>new l(s,t));i.useEffect(()=>{a.setOptions(t)},[a,t]);let r=i.useSyncExternalStore(i.useCallback(t=>a.subscribe(n.Vr.batchCalls(t)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),u=i.useCallback((t,e)=>{a.mutate(t,e).catch(o.ZT)},[a]);if(r.error&&(0,o.L3)(a.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:u,mutateAsync:r.mutate}}}},function(t){t.O(0,[690,891,971,472,744],function(){return t(t.s=236)}),_N_E=t.O()}]);