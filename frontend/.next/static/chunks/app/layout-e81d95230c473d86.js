(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{7872:function(t,e,s){Promise.resolve().then(s.bind(s,8813))},8813:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return RootLayout}});var r=s(7437),i=s(2265);s(2853);var n=s(8038),a=s(300),o=s(3002),u=s(7987),c=s(2996),l=class extends c.l{constructor(t={}){super(),this.config=t,this.#t=new Map}#t;build(t,e,s){let r=e.queryKey,i=e.queryHash??(0,a.Rm)(r,e),n=this.get(i);return n||(n=new o.A({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(e),state:s,defaultOptions:t.getQueryDefaults(r)}),this.add(n)),n}add(t){this.#t.has(t.queryHash)||(this.#t.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){let e=this.#t.get(t.queryHash);e&&(t.destroy(),e===t&&this.#t.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){u.Vr.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#t.get(t)}getAll(){return[...this.#t.values()]}find(t){let e={exact:!0,...t};return this.getAll().find(t=>(0,a._x)(e,t))}findAll(t={}){let e=this.getAll();return Object.keys(t).length>0?e.filter(e=>(0,a._x)(t,e)):e}notify(t){u.Vr.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){u.Vr.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){u.Vr.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},h=s(7470),d=class extends c.l{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#s=new Map,this.#r=0}#e;#s;#r;build(t,e,s){let r=new h.m({client:t,mutationCache:this,mutationId:++this.#r,options:t.defaultMutationOptions(e),state:s});return this.add(r),r}add(t){this.#e.add(t);let e=scopeFor(t);if("string"==typeof e){let s=this.#s.get(e);s?s.push(t):this.#s.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){let e=scopeFor(t);if("string"==typeof e){let s=this.#s.get(e);if(s){if(s.length>1){let e=s.indexOf(t);-1!==e&&s.splice(e,1)}else s[0]===t&&this.#s.delete(e)}}}this.notify({type:"removed",mutation:t})}canRun(t){let e=scopeFor(t);if("string"!=typeof e)return!0;{let s=this.#s.get(e),r=s?.find(t=>"pending"===t.state.status);return!r||r===t}}runNext(t){let e=scopeFor(t);if("string"!=typeof e)return Promise.resolve();{let s=this.#s.get(e)?.find(e=>e!==t&&e.state.isPaused);return s?.continue()??Promise.resolve()}}clear(){u.Vr.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#s.clear()})}getAll(){return Array.from(this.#e)}find(t){let e={exact:!0,...t};return this.getAll().find(t=>(0,a.X7)(e,t))}findAll(t={}){return this.getAll().filter(e=>(0,a.X7)(t,e))}notify(t){u.Vr.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){let t=this.getAll().filter(t=>t.state.isPaused);return u.Vr.batch(()=>Promise.all(t.map(t=>t.continue().catch(a.ZT))))}};function scopeFor(t){return t.options.scope?.id}var f=s(9198),p=s(436);function infiniteQueryBehavior(t){return{onFetch:(e,s)=>{let r=e.options,i=e.fetchOptions?.meta?.fetchMore?.direction,n=e.state.data?.pages||[],o=e.state.data?.pageParams||[],u={pages:[],pageParams:[]},c=0,fetchFn=async()=>{let s=!1,addSignalProperty=t=>{(0,a.I4)(t,()=>e.signal,()=>s=!0)},l=(0,a.cG)(e.options,e.fetchOptions),fetchPage=async(t,r,i)=>{if(s)return Promise.reject();if(null==r&&t.pages.length)return Promise.resolve(t);let n=(()=>{let t={client:e.client,queryKey:e.queryKey,pageParam:r,direction:i?"backward":"forward",meta:e.options.meta};return addSignalProperty(t),t})(),o=await l(n),{maxPages:u}=e.options,c=i?a.Ht:a.VX;return{pages:c(t.pages,o,u),pageParams:c(t.pageParams,r,u)}};if(i&&n.length){let t="backward"===i,e=t?getPreviousPageParam:getNextPageParam,s={pages:n,pageParams:o},a=e(r,s);u=await fetchPage(s,a,t)}else{let e=t??n.length;do{let t=0===c?o[0]??r.initialPageParam:getNextPageParam(r,u);if(c>0&&null==t)break;u=await fetchPage(u,t),c++}while(c<e)}return u};e.options.persister?e.fetchFn=()=>e.options.persister?.(fetchFn,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},s):e.fetchFn=fetchFn}}}function getNextPageParam(t,{pages:e,pageParams:s}){let r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,s[r],s):void 0}function getPreviousPageParam(t,{pages:e,pageParams:s}){return e.length>0?t.getPreviousPageParam?.(e[0],e,s[0],s):void 0}var m=class{#i;#n;#a;#o;#u;#c;#l;#h;constructor(t={}){this.#i=t.queryCache||new l,this.#n=t.mutationCache||new d,this.#a=t.defaultOptions||{},this.#o=new Map,this.#u=new Map,this.#c=0}mount(){this.#c++,1===this.#c&&(this.#l=f.j.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#i.onFocus())}),this.#h=p.N.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#i.onOnline())}))}unmount(){this.#c--,0===this.#c&&(this.#l?.(),this.#l=void 0,this.#h?.(),this.#h=void 0)}isFetching(t){return this.#i.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#n.findAll({...t,status:"pending"}).length}getQueryData(t){let e=this.defaultQueryOptions({queryKey:t});return this.#i.get(e.queryHash)?.state.data}ensureQueryData(t){let e=this.defaultQueryOptions(t),s=this.#i.build(this,e),r=s.state.data;return void 0===r?this.fetchQuery(t):(t.revalidateIfStale&&s.isStaleByTime((0,a.KC)(e.staleTime,s))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#i.findAll(t).map(({queryKey:t,state:e})=>{let s=e.data;return[t,s]})}setQueryData(t,e,s){let r=this.defaultQueryOptions({queryKey:t}),i=this.#i.get(r.queryHash),n=i?.state.data,o=(0,a.SE)(e,n);if(void 0!==o)return this.#i.build(this,r).setData(o,{...s,manual:!0})}setQueriesData(t,e,s){return u.Vr.batch(()=>this.#i.findAll(t).map(({queryKey:t})=>[t,this.setQueryData(t,e,s)]))}getQueryState(t){let e=this.defaultQueryOptions({queryKey:t});return this.#i.get(e.queryHash)?.state}removeQueries(t){let e=this.#i;u.Vr.batch(()=>{e.findAll(t).forEach(t=>{e.remove(t)})})}resetQueries(t,e){let s=this.#i;return u.Vr.batch(()=>(s.findAll(t).forEach(t=>{t.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){let s={revert:!0,...e},r=u.Vr.batch(()=>this.#i.findAll(t).map(t=>t.cancel(s)));return Promise.all(r).then(a.ZT).catch(a.ZT)}invalidateQueries(t,e={}){return u.Vr.batch(()=>(this.#i.findAll(t).forEach(t=>{t.invalidate()}),t?.refetchType==="none")?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e))}refetchQueries(t,e={}){let s={...e,cancelRefetch:e.cancelRefetch??!0},r=u.Vr.batch(()=>this.#i.findAll(t).filter(t=>!t.isDisabled()&&!t.isStatic()).map(t=>{let e=t.fetch(void 0,s);return s.throwOnError||(e=e.catch(a.ZT)),"paused"===t.state.fetchStatus?Promise.resolve():e}));return Promise.all(r).then(a.ZT)}fetchQuery(t){let e=this.defaultQueryOptions(t);void 0===e.retry&&(e.retry=!1);let s=this.#i.build(this,e);return s.isStaleByTime((0,a.KC)(e.staleTime,s))?s.fetch(e):Promise.resolve(s.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(a.ZT).catch(a.ZT)}fetchInfiniteQuery(t){return t.behavior=infiniteQueryBehavior(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(a.ZT).catch(a.ZT)}ensureInfiniteQueryData(t){return t.behavior=infiniteQueryBehavior(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return p.N.isOnline()?this.#n.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#i}getMutationCache(){return this.#n}getDefaultOptions(){return this.#a}setDefaultOptions(t){this.#a=t}setQueryDefaults(t,e){this.#o.set((0,a.Ym)(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){let e=[...this.#o.values()],s={};return e.forEach(e=>{(0,a.to)(t,e.queryKey)&&Object.assign(s,e.defaultOptions)}),s}setMutationDefaults(t,e){this.#u.set((0,a.Ym)(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){let e=[...this.#u.values()],s={};return e.forEach(e=>{(0,a.to)(t,e.mutationKey)&&Object.assign(s,e.defaultOptions)}),s}defaultQueryOptions(t){if(t._defaulted)return t;let e={...this.#a.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=(0,a.Rm)(e.queryKey,e)),void 0===e.refetchOnReconnect&&(e.refetchOnReconnect="always"!==e.networkMode),void 0===e.throwOnError&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===a.CN&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#a.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#i.clear(),this.#n.clear()}};function shouldRetry(t,e){return(!e||"number"!=typeof e.status||!(e.status>=400)||!(e.status<500))&&t<2}function exponentialBackoff(t){return Math.min(2e3,300*Math.pow(2,t)+100*Math.random())}let y=new m({defaultOptions:{queries:{retry:shouldRetry,retryDelay:exponentialBackoff,refetchOnWindowFocus:!1,refetchOnReconnect:!1,staleTime:12e4}}});var g=s(4033),b=s(3588),x=s(9891),v=s(9843);let P=new Set(["/login","/register"]);function isPublicRoute(t){return P.has(t)}function useMeQuery(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return(0,x.a)({queryKey:["me"],queryFn:v.jo,enabled:t,initialData:(()=>{try{let t=localStorage.getItem("me");return t?JSON.parse(t):void 0}catch(t){return}})(),staleTime:3e5,retry:!1,refetchOnWindowFocus:!1,refetchOnMount:!0})}function useAuthGuard(){var t,e,s;let r=(0,g.usePathname)(),n=(0,g.useRouter)(),a=isPublicRoute(r),o=useMeQuery(!0);return(0,i.useEffect)(()=>{!a&&o.isError&&n.replace("/login")},[a,o.isError,n]),(0,i.useEffect)(()=>{var t;a&&(null===(t=o.data)||void 0===t?void 0:t.user)&&n.replace("/dashboard")},[a,null===(t=o.data)||void 0===t?void 0:t.user,n]),{pathname:r,isPublic:a,isLoading:!a&&o.isLoading,user:null===(e=o.data)||void 0===e?void 0:e.user,isAuthenticated:!!(null===(s=o.data)||void 0===s?void 0:s.user)}}async function logoutUser(t){await (0,v.kS)();try{localStorage.removeItem("me")}catch(t){}t.clear()}function Navbar(t){var e;let{user:s}=t,i=(0,g.useRouter)(),a=(0,n.NL)(),o=(0,b.D)({mutationFn:()=>logoutUser(a),onSuccess:async()=>{i.push("/login")}});return(0,r.jsx)("header",{className:"h-14 border-b border-slate-200 bg-white/95 backdrop-blur",children:(0,r.jsxs)("div",{className:"mx-auto flex h-full w-full max-w-[1200px] items-center justify-between px-1",children:[(0,r.jsx)("div",{className:"flex items-center gap-3",children:(0,r.jsx)("span",{className:"text-sm font-semibold text-slate-700",children:"DevTrack Workspace"})}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,r.jsx)("span",{className:"rounded-full border border-blue-200 bg-blue-50 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-blue-700",children:null!==(e=null==s?void 0:s.name)&&void 0!==e?e:"User"}),(0,r.jsx)("button",{type:"button",className:"dt-btn-secondary px-3 py-1.5",onClick:()=>o.mutate(),disabled:o.isPending,children:o.isPending?"Logging out...":"Logout"})]})]})})}var j=s(7947),w=s(1396),O=s.n(w);let C=[{label:"Dashboard",href:"/dashboard"},{label:"Projects",href:"/projects"}];function isActive(t,e){return"/dashboard"===e?"/dashboard"===t:t.startsWith(e)}function Sidebar(){let t=(0,g.usePathname)(),e=t.split("/").filter(Boolean),s="projects"===e[0]&&!!e[1],i=s?e[1]:null;return(0,r.jsxs)("aside",{className:"hidden w-64 shrink-0 border-r border-slate-200 bg-white lg:flex lg:flex-col",children:[(0,r.jsx)("div",{className:"h-14 border-b border-slate-200 px-5",children:(0,r.jsxs)("div",{className:"flex h-full items-center gap-2",children:[(0,r.jsx)("span",{className:"inline-flex h-6 w-6 items-center justify-center rounded-md bg-blue-600 text-[10px] font-bold text-white shadow-sm",children:"IT"}),(0,r.jsx)("span",{className:"text-sm font-semibold text-slate-900",children:"DevTrack"})]})}),(0,r.jsxs)("nav",{className:"px-3 py-5",children:[(0,r.jsx)("p",{className:"px-2 pb-2 text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Navigation"}),(0,r.jsx)("ul",{className:"space-y-1",children:C.map(e=>{let s=isActive(t,e.href);return(0,r.jsx)("li",{children:(0,r.jsx)(O(),{href:e.href,className:"block rounded-md px-3 py-2.5 text-sm ".concat(s?"border-l-2 border-blue-600 bg-blue-50 font-semibold text-blue-800 shadow-sm":"border-l-2 border-transparent text-slate-600 hover:bg-slate-100 hover:text-slate-900"),children:e.label})},e.label)})})]}),s&&(0,r.jsxs)("div",{className:"border-t border-slate-200 px-3 py-5",children:[(0,r.jsx)("p",{className:"px-2 pb-2 text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Current Project"}),(0,r.jsxs)("ul",{className:"space-y-1",children:[(0,r.jsx)("li",{children:(0,r.jsx)(O(),{href:i?"/projects/".concat(i,"/issues"):"/projects",className:"block rounded-md px-3 py-2.5 text-sm ".concat(t.includes("/issues/")?"border-l-2 border-blue-600 bg-blue-50 font-semibold text-blue-800 shadow-sm":"border-l-2 border-transparent text-slate-600 hover:bg-slate-100 hover:text-slate-900"),children:"Issue Board"})}),(0,r.jsx)("li",{children:(0,r.jsxs)("p",{className:"rounded-md px-3 py-2 font-mono text-xs text-slate-500",children:["ID: ",i]})})]})]})]})}function RootLayout(t){let{children:e}=t;return(0,r.jsx)("html",{lang:"en",children:(0,r.jsx)("body",{className:"min-h-screen bg-slate-50 text-slate-900",children:(0,r.jsx)(n.aH,{client:y,children:(0,r.jsx)(AppShell,{children:e})})})})}function AppShell(t){let{children:e}=t,{isPublic:s,isLoading:i,user:n,isAuthenticated:a}=useAuthGuard();return s?(0,r.jsx)("main",{className:"min-h-screen bg-slate-100",children:e}):s||!i&&a?(0,r.jsxs)("div",{className:"flex min-h-screen bg-slate-100",children:[(0,r.jsx)(Sidebar,{}),(0,r.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,r.jsx)(Navbar,{user:n}),(0,r.jsx)("main",{className:"px-6 py-6 lg:px-8",children:(0,r.jsx)("div",{className:"mx-auto w-full max-w-[1200px]",children:e})})]})]}):(0,r.jsx)(j.Z,{label:"Checking session...",fullScreen:!0})}},7947:function(t,e,s){"use strict";s.d(e,{Z:function(){return LoadingState}});var r=s(7437);function LoadingState(t){let{label:e="Loading...",fullScreen:s=!1}=t,i=(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("span",{className:"inline-flex h-5 w-5 animate-spin rounded-full border-2 border-blue-200 border-t-blue-600","aria-hidden":"true"}),(0,r.jsx)("span",{children:e})]});return s?(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-slate-100 px-6",children:(0,r.jsx)("div",{className:"dt-card w-full max-w-sm p-6 text-sm text-slate-600",children:i})}):(0,r.jsx)("div",{className:"dt-card p-5 text-sm text-slate-600",children:i})}},9843:function(t,e,s){"use strict";s.d(e,{$L:function(){return createProject},$Q:function(){return addProjectMember},EG:function(){return getIssues},Ge:function(){return getIssue},TN:function(){return getDashboardMetrics},YW:function(){return updateIssueStatus},e5:function(){return getProject},gr:function(){return assignIssue},jo:function(){return getMe},kS:function(){return logout},mW:function(){return getProjects},v:function(){return createIssue},x4:function(){return login},z2:function(){return register}});var r,i=s(2601);let n=null!==(r=i.env.NEXT_PUBLIC_API_URL)&&void 0!==r?r:"http://localhost:4000/api";let ApiRequestError=class ApiRequestError extends Error{constructor(t,e){super(t),this.name="ApiRequestError",this.status=e}};function toErrorMessage(t,e){if(!t)return e||"Request failed";try{var s,r;let e=JSON.parse(t);if(e.message)return e.message;if(e.error)return e.error;if((null===(s=e.errors)||void 0===s?void 0:s.length)&&(null===(r=e.errors[0])||void 0===r?void 0:r.msg))return e.errors[0].msg}catch(t){}return t}async function apiFetch(t,e){let s;let r=new AbortController,i=setTimeout(()=>r.abort(),1e4);(null==e?void 0:e.signal)&&(e.signal.aborted?r.abort():e.signal.addEventListener("abort",()=>r.abort(),{once:!0}));try{s=await fetch("".concat(n).concat(t),{credentials:"include",headers:{"Content-Type":"application/json",...(null==e?void 0:e.headers)||{}},...e,signal:r.signal})}catch(t){if(t instanceof Error&&"AbortError"===t.name)throw new ApiRequestError("Request timed out. Please try again.");throw new ApiRequestError("Network error. Please check your connection and try again.")}finally{clearTimeout(i)}if(!s.ok){let t=await s.text();throw new ApiRequestError(toErrorMessage(t,s.statusText),s.status)}if(204!==s.status)return await s.json()}function getMe(){return apiFetch("/auth/me")}function login(t){return apiFetch("/auth/login",{method:"POST",body:JSON.stringify(t)})}function register(t){return apiFetch("/auth/register",{method:"POST",body:JSON.stringify(t)})}function logout(){return apiFetch("/auth/logout",{method:"POST"})}function getProjects(){return apiFetch("/projects")}function getDashboardMetrics(){return apiFetch("/projects/metrics")}function createProject(t){return apiFetch("/projects",{method:"POST",body:JSON.stringify(t)})}function getProject(t){return apiFetch("/projects/".concat(t))}function addProjectMember(t,e){return apiFetch("/projects/".concat(t,"/members"),{method:"POST",body:JSON.stringify({memberId:e})})}function getIssues(t,e){let s=new URLSearchParams;return e.status&&s.set("status",e.status),e.priority&&s.set("priority",e.priority),e.page&&s.set("page",String(e.page)),e.limit&&s.set("limit",String(e.limit)),apiFetch("/projects/".concat(t,"/issues?").concat(s.toString()))}function createIssue(t){return apiFetch("/projects/".concat(t.projectId,"/issues"),{method:"POST",body:JSON.stringify({title:t.title,description:t.description,priority:t.priority})})}function updateIssueStatus(t,e){return apiFetch("/issues/".concat(t,"/status"),{method:"PATCH",body:JSON.stringify({status:e})})}function assignIssue(t,e){return apiFetch("/issues/".concat(t,"/assign"),{method:"PATCH",body:JSON.stringify({assigneeId:e})})}function getIssue(t){return apiFetch("/issues/".concat(t))}},2853:function(){},4033:function(t,e,s){t.exports=s(94)},7470:function(t,e,s){"use strict";s.d(e,{R:function(){return getDefaultState},m:function(){return a}});var r=s(7987),i=s(9024),n=s(1640),a=class extends i.F{#d;#f;#n;#p;constructor(t){super(),this.#d=t.client,this.mutationId=t.mutationId,this.#n=t.mutationCache,this.#f=[],this.state=t.state||getDefaultState(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#f.includes(t)||(this.#f.push(t),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#f=this.#f.filter(e=>e!==t),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#f.length||("pending"===this.state.status?this.scheduleGc():this.#n.remove(this))}continue(){return this.#p?.continue()??this.execute(this.state.variables)}async execute(t){let onContinue=()=>{this.#m({type:"continue"})},e={client:this.#d,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#p=(0,n.Mz)({fn:()=>this.options.mutationFn?this.options.mutationFn(t,e):Promise.reject(Error("No mutationFn found")),onFail:(t,e)=>{this.#m({type:"failed",failureCount:t,error:e})},onPause:()=>{this.#m({type:"pause"})},onContinue,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});let s="pending"===this.state.status,r=!this.#p.canStart();try{if(s)onContinue();else{this.#m({type:"pending",variables:t,isPaused:r}),this.#n.config.onMutate&&await this.#n.config.onMutate(t,this,e);let s=await this.options.onMutate?.(t,e);s!==this.state.context&&this.#m({type:"pending",context:s,variables:t,isPaused:r})}let i=await this.#p.start();return await this.#n.config.onSuccess?.(i,t,this.state.context,this,e),await this.options.onSuccess?.(i,t,this.state.context,e),await this.#n.config.onSettled?.(i,null,this.state.variables,this.state.context,this,e),await this.options.onSettled?.(i,null,t,this.state.context,e),this.#m({type:"success",data:i}),i}catch(s){try{await this.#n.config.onError?.(s,t,this.state.context,this,e)}catch(t){Promise.reject(t)}try{await this.options.onError?.(s,t,this.state.context,e)}catch(t){Promise.reject(t)}try{await this.#n.config.onSettled?.(void 0,s,this.state.variables,this.state.context,this,e)}catch(t){Promise.reject(t)}try{await this.options.onSettled?.(void 0,s,t,this.state.context,e)}catch(t){Promise.reject(t)}throw this.#m({type:"error",error:s}),s}finally{this.#n.runNext(this)}}#m(t){this.state=(e=>{switch(t.type){case"failed":return{...e,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...e,isPaused:!0};case"continue":return{...e,isPaused:!1};case"pending":return{...e,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...e,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...e,data:void 0,error:t.error,failureCount:e.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}})(this.state),r.Vr.batch(()=>{this.#f.forEach(e=>{e.onMutationUpdate(t)}),this.#n.notify({mutation:this,type:"updated",action:t})})}};function getDefaultState(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}},3588:function(t,e,s){"use strict";s.d(e,{D:function(){return useMutation}});var r=s(2265),i=s(7470),n=s(7987),a=s(2996),o=s(300),u=class extends a.l{#d;#y=void 0;#g;#b;constructor(t,e){super(),this.#d=t,this.setOptions(e),this.bindMethods(),this.#x()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){let e=this.options;this.options=this.#d.defaultMutationOptions(t),(0,o.VS)(this.options,e)||this.#d.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#g,observer:this}),e?.mutationKey&&this.options.mutationKey&&(0,o.Ym)(e.mutationKey)!==(0,o.Ym)(this.options.mutationKey)?this.reset():this.#g?.state.status==="pending"&&this.#g.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#g?.removeObserver(this)}onMutationUpdate(t){this.#x(),this.#v(t)}getCurrentResult(){return this.#y}reset(){this.#g?.removeObserver(this),this.#g=void 0,this.#x(),this.#v()}mutate(t,e){return this.#b=e,this.#g?.removeObserver(this),this.#g=this.#d.getMutationCache().build(this.#d,this.options),this.#g.addObserver(this),this.#g.execute(t)}#x(){let t=this.#g?.state??(0,i.R)();this.#y={...t,isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}}#v(t){n.Vr.batch(()=>{if(this.#b&&this.hasListeners()){let e=this.#y.variables,s=this.#y.context,r={client:this.#d,meta:this.options.meta,mutationKey:this.options.mutationKey};if(t?.type==="success"){try{this.#b.onSuccess?.(t.data,e,s,r)}catch(t){Promise.reject(t)}try{this.#b.onSettled?.(t.data,null,e,s,r)}catch(t){Promise.reject(t)}}else if(t?.type==="error"){try{this.#b.onError?.(t.error,e,s,r)}catch(t){Promise.reject(t)}try{this.#b.onSettled?.(void 0,t.error,e,s,r)}catch(t){Promise.reject(t)}}}this.listeners.forEach(t=>{t(this.#y)})})}},c=s(8038);function useMutation(t,e){let s=(0,c.NL)(e),[i]=r.useState(()=>new u(s,t));r.useEffect(()=>{i.setOptions(t)},[i,t]);let a=r.useSyncExternalStore(r.useCallback(t=>i.subscribe(n.Vr.batchCalls(t)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),l=r.useCallback((t,e)=>{i.mutate(t,e).catch(o.ZT)},[i]);if(a.error&&(0,o.L3)(i.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:l,mutateAsync:a.mutate}}}},function(t){t.O(0,[690,891,971,472,744],function(){return t(t.s=7872)}),_N_E=t.O()}]);