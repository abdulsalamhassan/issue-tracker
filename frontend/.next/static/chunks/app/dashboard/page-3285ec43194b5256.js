(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{2963:function(e,t,s){Promise.resolve().then(s.bind(s,227))},227:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return DashboardPage}});var r=s(7437),a=s(1396),n=s.n(a),i=s(2265),o=s(9891),l=s(9843),d=s(7947),c=s(4655);let u=["open","in_progress","closed","archived"];function DashboardPage(){var e,t,s,a,g,p,v,h,m,x,j,f,b,N,y,P,S,I,w,M,L,O,C,F,_,E,T,k,R,D,J,A;let q=(0,o.a)({queryKey:["projects"],queryFn:l.mW}),Z=(0,i.useMemo)(()=>{var e;return(null===(e=q.data)||void 0===e?void 0:e.projects)?q.data.projects.slice(0,5):[]},[null===(e=q.data)||void 0===e?void 0:e.projects]),G=(0,i.useMemo)(()=>{var e,t;return null!==(t=null===(e=q.data)||void 0===e?void 0:e.projects.map(e=>e.id))&&void 0!==t?t:[]},[null===(t=q.data)||void 0===t?void 0:t.projects]),K=(0,o.a)({queryKey:["dashboard-metrics",G],enabled:G.length>0,queryFn:async()=>{let e=await Promise.all(G.map(async e=>{let t={open:0,in_progress:0,closed:0,archived:0};return await Promise.all(u.map(async s=>{let r=await (0,l.EG)(e,{status:s,page:1,limit:1});t[s]=r.total})),t}));return e.reduce((e,t)=>{let s=t.open+t.in_progress>0,r=!s&&t.closed>0;return e.open+=t.open,e.inProgress+=t.in_progress,e.done+=t.closed,e.archived+=t.archived,e.projectsInProgress+=s?1:0,e.projectsDone+=r?1:0,e.totalIssues+=t.open+t.in_progress+t.closed+t.archived,e},{totalIssues:0,inProgress:0,done:0,open:0,archived:0,projectsInProgress:0,projectsDone:0})}}),U=(0,i.useMemo)(()=>{if(!K.data)return 0;let e=K.data.open+K.data.inProgress+K.data.done;return 0===e?0:Math.round(K.data.done/e*100)},[K.data]);return(0,r.jsxs)("div",{className:"dt-page",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"dt-title",children:"Dashboard"}),(0,r.jsx)("p",{className:"dt-subtitle",children:"Overview of project activity and quick navigation."})]}),(0,r.jsx)(n(),{href:"/projects",className:"dt-btn-primary",children:"Manage Projects"})]}),q.isLoading&&(0,r.jsx)(d.Z,{label:"Loading dashboard..."}),q.isError&&(0,r.jsx)(c.Z,{message:q.error.message}),q.isSuccess&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[(0,r.jsx)(MetricCard,{label:"Total Projects",value:q.data.projects.length,tone:"neutral"}),(0,r.jsx)(MetricCard,{label:"Projects In Progress",value:null!==(I=null===(s=K.data)||void 0===s?void 0:s.projectsInProgress)&&void 0!==I?I:0,tone:"amber",loading:K.isLoading}),(0,r.jsx)(MetricCard,{label:"Done Projects",value:null!==(w=null===(a=K.data)||void 0===a?void 0:a.projectsDone)&&void 0!==w?w:0,tone:"green",loading:K.isLoading}),(0,r.jsx)(MetricCard,{label:"Completion Rate",value:"".concat(U,"%"),tone:"slate",loading:K.isLoading})]}),(0,r.jsxs)("div",{className:"grid gap-4 xl:grid-cols-5",children:[(0,r.jsx)(MetricCard,{label:"Total Issues",value:null!==(M=null===(g=K.data)||void 0===g?void 0:g.totalIssues)&&void 0!==M?M:0,tone:"neutral",loading:K.isLoading}),(0,r.jsx)(MetricCard,{label:"Open",value:null!==(L=null===(p=K.data)||void 0===p?void 0:p.open)&&void 0!==L?L:0,tone:"slate",loading:K.isLoading}),(0,r.jsx)(MetricCard,{label:"In Progress",value:null!==(O=null===(v=K.data)||void 0===v?void 0:v.inProgress)&&void 0!==O?O:0,tone:"amber",loading:K.isLoading}),(0,r.jsx)(MetricCard,{label:"Done",value:null!==(C=null===(h=K.data)||void 0===h?void 0:h.done)&&void 0!==C?C:0,tone:"green",loading:K.isLoading}),(0,r.jsx)(MetricCard,{label:"Archived",value:null!==(F=null===(m=K.data)||void 0===m?void 0:m.archived)&&void 0!==F?F:0,tone:"neutral",loading:K.isLoading})]}),K.isError&&(0,r.jsx)(c.Z,{message:K.error.message}),(0,r.jsxs)("div",{className:"dt-card space-y-4 p-5",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-base font-semibold text-slate-900",children:"Issue Status Overview"}),(0,r.jsx)("p",{className:"text-xs text-slate-500",children:"Across all projects"})]}),(0,r.jsx)(StatusRow,{label:"Open",value:null!==(_=null===(x=K.data)||void 0===x?void 0:x.open)&&void 0!==_?_:0,total:null!==(E=null===(j=K.data)||void 0===j?void 0:j.totalIssues)&&void 0!==E?E:0,color:"bg-slate-400",loading:K.isLoading}),(0,r.jsx)(StatusRow,{label:"In Progress",value:null!==(T=null===(f=K.data)||void 0===f?void 0:f.inProgress)&&void 0!==T?T:0,total:null!==(k=null===(b=K.data)||void 0===b?void 0:b.totalIssues)&&void 0!==k?k:0,color:"bg-amber-400",loading:K.isLoading}),(0,r.jsx)(StatusRow,{label:"Done",value:null!==(R=null===(N=K.data)||void 0===N?void 0:N.done)&&void 0!==R?R:0,total:null!==(D=null===(y=K.data)||void 0===y?void 0:y.totalIssues)&&void 0!==D?D:0,color:"bg-green-500",loading:K.isLoading}),(0,r.jsx)(StatusRow,{label:"Archived",value:null!==(J=null===(P=K.data)||void 0===P?void 0:P.archived)&&void 0!==J?J:0,total:null!==(A=null===(S=K.data)||void 0===S?void 0:S.totalIssues)&&void 0!==A?A:0,color:"bg-slate-300",loading:K.isLoading})]}),(0,r.jsxs)("div",{className:"dt-card overflow-hidden",children:[(0,r.jsx)("div",{className:"border-b border-slate-200 bg-slate-50 px-4 py-3",children:(0,r.jsx)("p",{className:"text-sm font-medium text-slate-700",children:"Recent Projects"})}),(0,r.jsxs)("table",{className:"dt-table",children:[(0,r.jsx)("thead",{className:"dt-thead",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3",children:"Project"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Key"}),(0,r.jsx)("th",{className:"px-4 py-3 text-right",children:"Action"})]})}),(0,r.jsx)("tbody",{children:0===Z.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:3,className:"px-4 py-6 text-center text-slate-500",children:"No projects yet."})}):Z.map(e=>(0,r.jsxs)("tr",{className:"dt-row",children:[(0,r.jsxs)("td",{className:"px-4 py-4",children:[(0,r.jsx)("p",{className:"font-medium text-slate-900",children:e.name}),(0,r.jsx)("p",{className:"text-xs text-slate-500",children:e.description||"No description provided."})]}),(0,r.jsx)("td",{className:"px-4 py-4 text-slate-600",children:e.key}),(0,r.jsx)("td",{className:"px-4 py-4 text-right",children:(0,r.jsx)(n(),{href:"/projects/".concat(e.id,"/issues"),className:"dt-btn-ghost inline-flex",children:"View Issues"})})]},e.id))})]})]})]})]})}function MetricCard(e){let{label:t,value:s,tone:a,loading:n=!1}=e;return(0,r.jsxs)("div",{className:"dt-kpi ".concat({neutral:"border-slate-200",slate:"border-slate-300",amber:"border-amber-200 bg-amber-50/40",green:"border-green-200 bg-green-50/40"}[a]),children:[(0,r.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:t}),(0,r.jsx)("p",{className:"mt-3 text-3xl font-semibold ".concat({neutral:"text-slate-900",slate:"text-slate-800",amber:"text-amber-700",green:"text-green-700"}[a]),children:n?"--":s})]})}function StatusRow(e){let{label:t,value:s,total:a,color:n,loading:i=!1}=e,o=a>0?Math.round(s/a*100):0;return(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsx)("span",{className:"font-medium text-slate-700",children:t}),(0,r.jsx)("span",{className:"text-slate-500",children:i?"--":"".concat(s," (").concat(o,"%)")})]}),(0,r.jsx)("div",{className:"h-2 rounded-md bg-slate-100",children:(0,r.jsx)("div",{className:"h-2 rounded-md ".concat(n),style:{width:"".concat(i?0:o,"%")}})})]})}},4655:function(e,t,s){"use strict";s.d(t,{Z:function(){return ErrorState}});var r=s(7437);function ErrorState(e){let{message:t}=e;return(0,r.jsx)("div",{className:"dt-card border-red-200 bg-red-50/40 p-4 text-sm text-red-700",children:t})}},7947:function(e,t,s){"use strict";s.d(t,{Z:function(){return LoadingState}});var r=s(7437);function LoadingState(e){let{label:t="Loading..."}=e;return(0,r.jsx)("div",{className:"dt-card p-5 text-sm text-slate-600",children:t})}},9843:function(e,t,s){"use strict";s.d(t,{$L:function(){return createProject},$Q:function(){return addProjectMember},EG:function(){return getIssues},Ge:function(){return getIssue},YW:function(){return updateIssueStatus},e5:function(){return getProject},gr:function(){return assignIssue},jo:function(){return getMe},kS:function(){return logout},mW:function(){return getProjects},v:function(){return createIssue},x4:function(){return login},z2:function(){return register}});var r,a=s(2601);let n=null!==(r=a.env.NEXT_PUBLIC_API_URL)&&void 0!==r?r:"http://localhost:4000/api";function toErrorMessage(e,t){if(!e)return t||"Request failed";try{var s,r;let t=JSON.parse(e);if(t.message)return t.message;if(t.error)return t.error;if((null===(s=t.errors)||void 0===s?void 0:s.length)&&(null===(r=t.errors[0])||void 0===r?void 0:r.msg))return t.errors[0].msg}catch(e){}return e}async function apiFetch(e,t){let s=await fetch("".concat(n).concat(e),{credentials:"include",headers:{"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}},...t});if(!s.ok){let e=await s.text();throw Error(toErrorMessage(e,s.statusText))}if(204!==s.status)return await s.json()}function getMe(){return apiFetch("/auth/me")}function login(e){return apiFetch("/auth/login",{method:"POST",body:JSON.stringify(e)})}function register(e){return apiFetch("/auth/register",{method:"POST",body:JSON.stringify(e)})}function logout(){return apiFetch("/auth/logout",{method:"POST"})}function getProjects(){return apiFetch("/projects")}function createProject(e){return apiFetch("/projects",{method:"POST",body:JSON.stringify(e)})}function getProject(e){return apiFetch("/projects/".concat(e))}function addProjectMember(e,t){return apiFetch("/projects/".concat(e,"/members"),{method:"POST",body:JSON.stringify({memberId:t})})}function getIssues(e,t){let s=new URLSearchParams;return t.status&&s.set("status",t.status),t.priority&&s.set("priority",t.priority),t.page&&s.set("page",String(t.page)),t.limit&&s.set("limit",String(t.limit)),apiFetch("/projects/".concat(e,"/issues?").concat(s.toString()))}function createIssue(e){return apiFetch("/projects/".concat(e.projectId,"/issues"),{method:"POST",body:JSON.stringify({title:e.title,description:e.description,priority:e.priority})})}function updateIssueStatus(e,t){return apiFetch("/issues/".concat(e,"/status"),{method:"PATCH",body:JSON.stringify({status:t})})}function assignIssue(e,t){return apiFetch("/issues/".concat(e,"/assign"),{method:"PATCH",body:JSON.stringify({assigneeId:t})})}function getIssue(e){return apiFetch("/issues/".concat(e))}}},function(e){e.O(0,[690,891,971,472,744],function(){return e(e.s=2963)}),_N_E=e.O()}]);